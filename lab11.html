<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dependent User Profile Generator</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">
    <div class="bg-white shadow-lg rounded-lg p-6 w-full max-w-lg">
      <h1 class="text-2xl font-bold mb-4 text-center">
        Dependent User Profile Generator
      </h1>

      <!-- Button -->
      <button
        onclick="loadUserProfile()"
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full mb-4"
      >
        Load User Profile
      </button>

      <!-- Status Message -->
      <p id="status" class="text-center text-sm text-gray-600 mb-4">
        Click the button to begin.
      </p>

      <!-- User Data -->
      <div class="space-y-3">
        <div>
          <h2 class="font-semibold">Name:</h2>
          <p id="user-name" class="text-gray-800">---</p>
        </div>

        <div>
          <h2 class="font-semibold">Email:</h2>
          <p id="user-email" class="text-gray-800">---</p>
        </div>

        <div>
          <h2 class="font-semibold">Personalized Bio:</h2>
          <p id="user-bio" class="text-gray-800">---</p>
        </div>
      </div>
    </div>

    <!-- Script -->
    <script>
      /**
       * Mock API 2: Bio generator
       */
      function generateCustomBio(firstName) {
        return new Promise((resolve) => {
          setTimeout(() => {
            const bio =
              `Welcome, ${firstName}! We've created your personalized profile. ` +
              `Our system indicates you are a highly engaged user, eager to explore new technologies.`;
            resolve(bio);
          }, 1500);
        });
      }

      /**
       * Main function: Sequential + Dependent Await
       */
      async function loadUserProfile() {
        const nameEl = document.getElementById("user-name");
        const emailEl = document.getElementById("user-email");
        const bioEl = document.getElementById("user-bio");
        const statusEl = document.getElementById("status");

        // Reset UI before loading
        statusEl.textContent = "Loading user data...";
        nameEl.textContent = "---";
        emailEl.textContent = "---";
        bioEl.textContent = "---";

        try {
          // -------------------------------
          // Task 1: Fetch Primary Data
          // -------------------------------
          const response = await fetch("https://randomuser.me/api/");
          const data = await response.json();

          const user = data.results[0];
          const firstName = user.name.first;
          const lastName = user.name.last;
          const email = user.email;

          // Display primary data
          nameEl.textContent = `${firstName} ${lastName}`;
          emailEl.textContent = email;

          statusEl.textContent = "Generating personalized bio...";

          // -------------------------------
          // Task 2: Dependent Await
          // -------------------------------
          const bioResult = await generateCustomBio(firstName);

          bioEl.textContent = bioResult;

          statusEl.textContent = "Profile Loaded Successfully ✔️";
        } catch (error) {
          // -------------------------------
          // Task 3: Error Handling
          // -------------------------------
          console.error("Error loading user profile:", error);

          nameEl.textContent = "--- Data Load Failed ---";
          emailEl.textContent = "--- Data Load Failed ---";
          bioEl.textContent = "--- Data Load Failed ---";

          statusEl.textContent = "❌ Error: Unable to load data.";
        }
      }
    </script>
  </body>
</html>
